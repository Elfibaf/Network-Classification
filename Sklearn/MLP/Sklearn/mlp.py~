# Authors : Mehdi Crozes and Fabien Robin
# Date : June 9th 2016

# MLP for ARFF traffic network file 

import arff
import numpy as np
import time

from extraction import *
from sklearn.neural_network import MLPClassifier 
from sklearn.cross_validation import train_test_split
from sklearn.metrics import confusion_matrix
from sklearn.preprocessing import MinMaxScaler

# Step 1 : Import Arff file

arff_file = load_dataset("../../../Data/data_caida_original.arff")
print "Total dataset : "
print "Number of features :",len(arff_file.features)
print "Number of labels :",len(arff_file.labels)

# Step 2 : Building training_set and test_set

feature_train,feature_test,label_train,label_test = train_test_split(arff_file.features,arff_file.labels,test_size=0.25,random_state=42)

# Step 3 : Modeling and training our classifier with training's time
# Before that, we had to convert our feature_train_float into float type because our feature_train is an array of string and generate a TypeError

feature_train_float = feature_train.astype(np.float)
feature_test_float = feature_test.astype(np.float)

scaler = MinMaxScaler(copy='false')
feature_train_rescaled =scaler.fit_transform(feature_train_float)
feature_test_rescaled=scaler.fit_transform(feature_test_float) 

t0 = time.time()
clf = MLPClassifier(hidden_layer_sizes=(2,300), max_iter=30, alpha=1e-5,
                    activation='tanh',algorithm='sgd', verbose='true', tol=1e-4, random_state=1,
                    learning_rate_init=.1)
clf.fit(feature_train_rescaled,label_train)
print "Training  time ",round(time.time()-t0,3),"s"

t1= time.time()
clf.predict(feature_test_rescaled)
print "Predicting time ",round(time.time()-t1,3),"s"
print "Number of Classes :",len (clf.classes_)

# Step 4 : Generate Confusion Matrix

#confusion_matrix = confusion_matrix(label_test,label_pred)
#print confusion_matrix

# Step 5 : Accuracy 

score = clf.score(feature_test_rescaled,label_test)
print "Test Accuracy :",score 

# 40% pour 10 iterations
